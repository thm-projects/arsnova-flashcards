# THIS DOCKERFILE IS SUPPOSED TO RUN ON THE KANIKO EXECUTOR
# ON SCM-ADMIN - ARTIFACT FROM PIPELINE NEEDED!
FROM node:12 AS METEOR_BASE

ARG BUILD_DIR=$BUILD_DIR
ARG BUNDLE_DIR=$BUNDLE_DIR

ENV APP_HOME=/usr/app/
ENV DOCKER_BUILD_DIR=/usr/build/
WORKDIR $APP_HOME

RUN echo "$BUILD_DIR" > /build.txt
RUN echo "$BUNDLE_DIR" > /bundle.txt

# copy the artifact from gitlab CI
# WORKS ONLY ON THE THM SCM-BUILDER AND INSIDE OF A PIPELINE
RUN mkdir -p "$DOCKER_BUILD_DIR/bundle"
COPY "$BUNDLE_DIR" "$DOCKER_BUILD_DIR/bundle"

CMD ["/bin/bash"]
