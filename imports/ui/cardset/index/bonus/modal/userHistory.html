<template name="bonusUserHistoryModal">
    {{> bonusTaskHistoryModal}}
    <div class="modal fade" id="bonusUserHistoryModal" tabindex="-1" role="dialog"
         aria-labelledby="bonusUserHistoryTitle">
        {{#if gotUserData}}
            <div class="modal-dialog modal-lg">
                <div class="modal-content modal-lg modal-content-for-buttons">
                    <div class="modal-header">
                    <span class="modal-icon">
                        <i class="fas fa-clock"></i>
                    </span>
                        {{> mainModalItemCloseIcon}}
                        <h4 id="bonusUserHistoryTitle" class="modal-title">
                            {{getTitle}}
                        </h4>
                    </div>
                    <div class="modal-body">
                        {{#if gotHistoryData}}
                            <div class="user-history-title">
                                <h4>{{_ "leitnerProgress.modal.userHistory.stats.tasks.title"}}</h4>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-user-history table-history-global-stats">
                                    <tbody>
                                    <tr>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.tasks.total"}}:</td>
                                        <td>{{getTaskCount}}</td>
                                    </tr>
                                    <tr>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.tasks.completed"}}:</td>
                                        <td>{{getTaskCount 0}}</td>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.tasks.notCompleted"}}:</td>
                                        <td>{{getTaskCount 1}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="user-history-title">
                                <h4>{{_ "leitnerProgress.modal.userHistory.stats.workload.title"}}</h4>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-user-history table-history-global-stats">
                                    <tbody>
                                    <tr>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.workload.total"}}:</td>
                                        <td>{{getWorkloadCount 0}}</td>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.averageKnown"}}:</td>
                                        <td>{{getAverageScore}}</td>
                                    </tr>
                                    <tr>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.workload.known"}}:</td>
                                        <td>{{getWorkloadCount 1}}</td>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.workload.notKnown"}}:</td>
                                        <td>{{getWorkloadCount 2}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="user-history-title">
                                <h4>{{_ "leitnerProgress.modal.userHistory.stats.duration.title"}}</h4>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-user-history table-history-global-stats">
                                    <tbody>
                                    <tr>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.duration.total"}}:</td>
                                        <td>{{getTotalDuration}}</td>
                                    </tr>
                                    <tr>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.duration.average"}}:</td>
                                        <td>{{getAverageDuration}}</td>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.duration.cardArithmeticMean.stats"}}:</td>
                                        <td>{{getUserCardsArithmeticMean}}</td>
                                    </tr>
                                    <tr>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.duration.cardMedian"}}:</td>
                                        <td>{{getUserCardMedian}}</td>
                                        <td>{{_ "leitnerProgress.modal.userHistory.stats.duration.cardStandardDeviation"}}:</td>
                                        <td>{{getUserCardsStandardDeviation}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="user-history-title">
                                <h4>{{_ "leitnerProgress.modal.userHistory.table.title"}}</h4>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <tbody>
                                    <tr>
                                        <th><a class="sort-bonus-content sort-bonus-user-history" data-content="date">{{_ "leitnerProgress.modal.userHistory.table.date"}}</a> {{> cardsetLearnActivityStatisticItemSort (setSortObject "date")}}</th>
                                        <th><a class="sort-bonus-content sort-bonus-user-history" data-content="reason">{{_ "leitnerProgress.modal.userHistory.table.reason.title"}}</a> {{> cardsetLearnActivityStatisticItemSort (setSortObject "reason")}}</th>
                                        <th><a class="sort-bonus-content sort-bonus-user-history" data-content="workload">{{_ "leitnerProgress.modal.userHistory.table.workload.title"}}</a> {{> cardsetLearnActivityStatisticItemSort (setSortObject "workload")}}</th>
                                        <th><a class="sort-bonus-content sort-bonus-user-history" data-content="known">{{_ "leitnerProgress.modal.userHistory.table.known"}}</a> {{> cardsetLearnActivityStatisticItemSort (setSortObject "known")}}</th>
                                        <th><a class="sort-bonus-content sort-bonus-user-history" data-content="notKnown">{{_ "leitnerProgress.modal.userHistory.table.notKnown"}}</a> {{> cardsetLearnActivityStatisticItemSort (setSortObject "notKnown")}}</th>
                                        <th class="visible-md visible-lg"><a class="sort-bonus-content sort-bonus-user-history" data-content="statusCode">{{_ "leitnerProgress.modal.userHistory.table.status.title"}}</a> {{> cardsetLearnActivityStatisticItemSort (setSortObject "statusCode")}}</th>
                                        <th class="visible-lg"><a class="sort-bonus-content sort-bonus-user-history" data-content="duration">{{_ "leitnerProgress.modal.userHistory.table.duration"}}</a> {{> cardsetLearnActivityStatisticItemSort (setSortObject "duration")}}</th>
                                        <th class="visible-lg"><a class="sort-bonus-content sort-bonus-user-history" data-content="cardArithmeticMean">{{_ "leitnerProgress.modal.userHistory.stats.duration.cardArithmeticMean.filter"}}</a> {{> cardsetLearnActivityStatisticItemSort (setSortObject "cardArithmeticMean")}}</th>
                                        <th>{{_ "leitnerProgress.taskHistory"}}</th>
                                    </tr>
                                    {{#each getWorkloadHistory}}
                                        <tr>
                                            <td>{{getMomentsDate this.date}}</td>
                                            <td>{{getReason}}</td>
                                            <td>{{getWorkload}}</td>
                                            <td>{{this.known}}</td>
                                            <td>{{this.notKnown}}</td>
                                            <td class="visible-md visible-lg">{{this.statusText}}</td>
                                            <td class="visible-lg">{{getDuration this.duration}}</td>
                                            <td class="visible-lg">{{humanizeDuration this.cardArithmeticMean}}</td>
                                            <td>
                                                {{#if canDisplayTaskHistory}}
                                                <a class="showBonusTaskHistory" data-toggle="modal" href="#bonusTaskHistoryModal"
                                                   data-user="{{this.user_id}}"
                                                   data-cardset="{{this.cardset_id}}"
                                                   data-task="{{this.task_id}}"
                                                   data-known="{{this.known}}"
                                                   data-notknown="{{this.notKnown}}"
                                                   data-workload="{{this.workload}}"
                                                   data-reason="{{getReason}}"
                                                   data-duration="{{this.duration}}"
                                                   data-cardArithmeticMean="{{this.cardArithmeticMean}}"
                                                   data-cardMedian="{{this.cardMedian}}"
                                                   data-cardStandardDeviation="{{this.cardStandardDeviation}}"
                                                >
                                                <i class="far fa-clock" title="{{_ "leitnerProgress.tooltip.taskHistory"}}"
                                                   data-user="{{this.user_id}}"
                                                   data-cardset="{{this.cardset_id}}"
                                                   data-task="{{this.task_id}}"
                                                   data-known="{{this.known}}"
                                                   data-notknown="{{this.notKnown}}"
                                                   data-workload="{{this.workload}}"
                                                   data-reason="{{getReason}}"
                                                   data-duration="{{this.duration}}"
                                                   data-cardArithmeticMean="{{this.cardArithmeticMean}}"
                                                   data-cardMedian="{{this.cardMedian}}"
                                                   data-cardStandardDeviation="{{this.cardStandardDeviation}}"
                                                ></i></a>
                                                {{/if}}
                                            </td>
                                        </tr>
                                    {{/each}}
                                    </tbody>
                                </table>
                            </div>
                        {{else}}
                            {{> loadingScreen}}
                            <br>
                            <br>
                        {{/if}}
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        {{/if}}
    </div>
    <!-- /.modal -->
</template>
