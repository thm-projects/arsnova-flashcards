<template name="pool">
    {{#if isInRole 'firstLogin'}}
        {{> first_login_content_only}}
    {{else}}
        {{#if isInRole 'blocked'}}
            {{> access_denied_content_only}}
        {{else}}
            <div id="pool-category-region" class="container">
                {{> category}}
                {{> enterActiveLearnphaseModal}}
            </div>
        {{/if}}
    {{/if}}
</template>

<template name="category">
    <div class="buttonHeader">
        {{#if selectingCardsetToLearn}}
            <div class="bs-callout bs-callout-info selectionInfo">
                <a id="cancelSelection" class="btn btn-raised btn-danger">
                    {{_ "confirmLearn-form.cancel"}}
                </a>
                <span class="text">
                    {{_ "pool.selectCardToLearn"}}
                </span>
            </div>
            <br>
        {{/if}}
        <nav class="navbar navbar-default">
            <div class="container-fluid" id="pool-nav-wrapper">
                <div class="navbar-header">
                    <button class="resetFilters btn btn-raised btn-default hidden-lg" id="resetBtnMobile"
                            role="button"><i class="glyphicon glyphicon-filter"></i> {{_ "set-list.reset"}} </button>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#pool-nav"
                            aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse" id="pool-nav">
                    <ul class="nav navbar-nav col-lg-12">
                        <li>
                            <button class="resetFilters btn btn-raised btn-default visible-lg" id="resetBtn"
                                    role="button"><i class="glyphicon glyphicon-filter"></i> {{_ "set-list.reset"}}
                            </button>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false" id="topicBtn" value="down">
                                {{_ "set-list.topic"}}
                                <span class="glyphicon glyphicon-sort"></span>
                            </a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle authorBtn" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false">
                                {{_ "set-list.author"}}
                                {{#if hasAuthorFilter}}
                                    <span class="glyphicon glyphicon-filter"></span>
                                {{/if}}
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#" class="filterAuthor active" data-id="">{{_ "set-list.everyone"}}</a>
                                </li>
                                {{#each getAuthors}}
                                    {{#if filterAuthors}}
                                        <li>
                                            <a href="#" class="filterAuthor"
                                               data-id="{{this._id}}">{{this.profile.title}} {{this.profile.givenname}} {{this.profile.birthname}}
                                                {{#if poolFilterAuthor this._id}}
                                                    <span class="glyphicon glyphicon-filter"></span>
                                                {{/if}}
                                            </a>
                                        </li>
                                    {{/if}}
                                {{/each}}
                            </ul>
                        </li>
                        {{#unless singleUniversity}}
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle collegeBtn" data-toggle="dropdown" role="button"
                                   aria-haspopup="true" aria-expanded="false">
                                    {{_ "set-list.college"}}
                                    {{#if hasCollegeFilter}}
                                        <span class="glyphicon glyphicon-filter"></span>
                                    {{/if}}
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="#" class="filterCollege active" data-id="">{{_
                                                "set-list.everything"}}</a>
                                        <a href="#" class="filterNoModule active" data-id="">{{_
                                                "set-list.noCollege"}}</a>
                                    </li>
                                    {{#each getColleges}}
                                        <li>
                                            <a href="#" class="filterCollege"
                                               data-id="{{this.college}}">{{this.college}}
                                                {{#if poolFilterCollege this.college}}
                                                    <span class="glyphicon glyphicon-filter"></span>
                                                {{/if}}
                                            </a>
                                        </li>
                                    {{/each}}
                                </ul>
                            </li>
                        {{/unless}}
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle courseBtn" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false" id="collegeBtn">
                                {{_ "set-list.course"}}
                                {{#if hasCourseFilter}}
                                    <span class="glyphicon glyphicon-filter"></span>
                                {{/if}}
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#" class="filterCourse active" data-id="">{{_ "set-list.everything"}}</a>
                                    <a href="#" class="filterNoModule active" data-id="">{{_ "set-list.noCourse"}}</a>
                                </li>
                                {{#each getCourses}}
                                    <li>
                                        <a href="#" class="filterCourse" data-id="{{this.course}}">{{this.course}}
                                            {{#if poolFilterCourse this.course}}
                                                <span class="glyphicon glyphicon-filter"></span>
                                            {{/if}}
                                        </a>
                                    </li>
                                {{/each}}
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" id="moduleFilter" class="dropdown-toggle moduleBtn" data-toggle="dropdown"
                               role="button"
                               aria-haspopup="true" aria-expanded="false">
                                {{_ "set-list.module"}}
                                {{#if hasModuleFilter}}
                                    <span class="glyphicon glyphicon-filter"></span>
                                {{/if}}
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#" class="filterModule active" data-id="">{{_ "set-list.everything"}}</a>
                                    <a href="#" class="filterNoModule active" data-id="">{{_
                                            "set-list.noModuleLong"}}</a>
                                </li>
                                {{#each getModules}}
                                    <li><a href="#" class="filterModule" data-id="{{this.module}}">
                                        {{this.moduleToken}} [{{this.moduleNum}}]:
                                        {{this.module}}
                                        {{#if poolFilterModule this.module}}
                                            <span class="glyphicon glyphicon-filter"></span>
                                        {{/if}}
                                    </a></li>
                                {{/each}}
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" id="learnphaseFilter" class="dropdown-toggle" data-toggle="dropdown"
                               role="button"
                               aria-haspopup="true" aria-expanded="false">
                                {{_ "set-list.learnphase"}}
                                {{#if hasLearnphaseFilter}}
                                    <span class="glyphicon glyphicon-filter"></span>
                                {{/if}}
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#" class="filterLearnphase active">{{_ "set-list.everything"}}</a>
                                </li>
                                <li><a href="#" class="filterLearnphase" data-id="true">
                                    {{_ "set-list.activeLearnphase"}}
                                    {{#if poolFilterLearnphase true}}
                                        <span class="glyphicon glyphicon-filter"></span>
                                    {{/if}}
                                </a></li>
                                <li><a href="#" class="filterLearnphase" data-id="false">
                                    {{_ "set-list.inactiveLearnphase"}}
                                    {{#if poolFilterLearnphase false}}
                                        <span class="glyphicon glyphicon-filter"></span>
                                    {{/if}}
                                </a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" id="ratingFilter" class="dropdown-toggle ratingBtn" data-toggle="dropdown"
                               role="button"
                               aria-haspopup="true" aria-expanded="false">
                                {{_ "set-list.rating"}}
                                {{#if hasRatingFilter}}
                                    <span class="glyphicon glyphicon-filter"></span>
                                {{/if}}
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#" class="filterRating active" data-id="-1">{{_ "set-list.everything"}}</a>
                                </li>
                                <li><a href="#" class="filterRating" data-id="0">{{_ "set-list.ratingFilterPlural"
                                                                                     rating=0}}
                                    {{#if poolFilterRating 0}}
                                        <span class="glyphicon glyphicon-filter"></span>
                                    {{/if}}
                                </a>
                                </li>
                                <li><a href="#" class="filterRating" data-id="1">{{_ "set-list.ratingFilter"}}
                                    {{#if poolFilterRating 1}}
                                        <span class="glyphicon glyphicon-filter"></span>
                                    {{/if}}
                                </a>
                                </li>
                                <li><a href="#" class="filterRating" data-id="2">{{_ "set-list.ratingFilterPlural"
                                                                                     rating=2}}
                                    {{#if poolFilterRating 2}}
                                        <span class="glyphicon glyphicon-filter"></span>
                                    {{/if}}
                                </a>
                                </li>
                                <li><a href="#" class="filterRating" data-id="3">{{_ "set-list.ratingFilterPlural"
                                                                                     rating=3}}
                                    {{#if poolFilterRating 3}}
                                        <span class="glyphicon glyphicon-filter"></span>
                                    {{/if}}
                                </a>
                                </li>
                                <li><a href="#" class="filterRating" data-id="4">{{_ "set-list.ratingFilterPlural"
                                                                                     rating=4}}
                                    {{#if poolFilterRating 4}}
                                        <span class="glyphicon glyphicon-filter"></span>
                                    {{/if}}
                                </a>
                                </li>
                            </ul>
                        </li>
                        <ul class="nav navbar-nav navbar-right">
                            <div id="filterCheckbox" class="btn-group" role="group" data-toggle="buttons"
                                 aria-label="License group" style="padding-top: 20px;">
                                <label class="btn btn-default btn-info btn-sm active">
                                    <input type="checkbox" autocomplete="off" value="free" checked=""> Free
                                </label>
                                <label class="btn btn-default btn-success btn-sm active">
                                    <input type="checkbox" autocomplete="off" value="edu" checked=""> Edu
                                </label>
                                <label class="btn btn-default btn-danger btn-sm active">
                                    <input type="checkbox" autocomplete="off" value="pro" checked=""> Pro
                                </label>
                            </div>
                        </ul>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <div class="responsive-utilities-test visible-on">

        <span class="{{#unless
                singleUniversity}}col-sm-3{{else}}col-sm-4{{/unless}} hidden-xs poolHeaderBottom">{{_
                "set-list.topic"}}
        </span>
        <span class="{{#unless
                singleUniversity}}col-sm-3 col-md-2{{else}}col-sm-4 col-md-3{{/unless}} hidden-xs poolHeaderBottom">{{_
                "set-list.author"}}
        </span>
        {{#unless singleUniversity}}
            <span class="col-sm-2 hidden-xs poolHeaderBottom poolHeaderCollege">{{_
                    "set-list.college"}}
            </span>
        {{/unless}}
        <span class="col-sm-2 hidden-xs poolHeaderBottom poolHeaderCourse">{{_
                "set-list.course"}}
        </span>
        <span class="col-md-1 hidden-xs hidden-sm poolHeaderBottom">{{_
                "set-list.module"}}
        </span>
        <span class="col-sm-2 col-md-1 hidden-xs poolHeaderBottom">{{_
                "set-list.availability"}}
        </span>
        <span class="col-md-1 hidden-xs hidden-sm poolHeaderBottom">{{_
                "set-list.rating"}}
        </span>
    </div>
    {{#if getDecks.count}}
        {{#each getDecks}}
            <div class="col-xs-12 panel panel-default {{#if
                    oddRow @index}} altPanel {{/if}} cardsetInfo responsive-utilities-test visible-on">
                {{> poolCardsetRow extendContext 'index' @index}}
            </div>
        {{/each}}
        {{#if moreResults}}
            <a href="#" title="{{_ "set-list.moreResults"}}">
                <div class="showMoreResults col-xs-12 panel panel-default">
                    <span class="scrollArrow col-xs-12 glyphicon glyphicon-chevron-down"></span>
                </div>
            </a>
        {{/if}}
    {{else}}
        {{> poolCardsetEmpty}}
    {{/if}}
</template>

<template name="poolCardsetRow">
    <div class="cardsetName">
        <div class="tip-content">{{#if gotDescription description}}{{#markdown}}{{getMaximumText
                description}}{{/markdown}}{{else}}{{_
                "set-list.noDescription"}}{{/if}}</div>
        {{#if this.learningActive}}
            {{#if isProfileCompleted this._id}}
                {{#if isAlreadyLearning}}
                    <a href="/cardset/{{_id}}" class="panelUnitBorder field-tip"
                       title="{{_ "set-list.topic"}}: {{this.name}} ({{_ "pool.quantity"}}: {{countCards this._id}})">
                        {{>poolTitleContent content=this}}
                    </a>
                {{else}}
                    <a href="#" class="panelUnitBorder field-tip"
                       title="{{_ "set-list.topic"}}: {{this.name}} ({{_ "pool.quantity"}}: {{countCards this._id}})"
                       data-toggle="modal" data-target="#enterActiveLearnphaseModal">
                        {{>poolTitleContent content=this}}
                    </a>
                {{/if}}
            {{else}}
                <a href="#" class="panelUnitBorder field-tip"
                   title="{{_ "set-list.topic"}}: {{this.name}} ({{_ "pool.quantity"}}: {{countCards this._id}})"
                   data-toggle="modal" data-target="#completeProfileModal">
                    {{>poolTitleContent content=this}}
                </a>
            {{/if}}
        {{else}}
            <a href="/cardset/{{_id}}" class="panelUnitBorder field-tip"
               title="{{_ "set-list.topic"}}: {{this.name}} ({{_ "pool.quantity"}}: {{countCards this._id}})">
                {{>poolTitleContent content=this}}
            </a>
        {{/if}}
    </div>
    <a href="#" class="filterAuthor" title="Filter {{_ "set-list.author"}}: {{getAuthorName this.owner}}">
        <span class="col-xs-6 visible-xs poolLabel panelUnit" data-id="{{this.owner}}">{{_ "set-list.author"}}
            :</span>
        <span class="col-xs-6 {{#unless
                singleUniversity}}col-sm-3 col-md-2{{else}}col-sm-4 col-md-3{{/unless}} poolContent poolText panelUnit poolAuthor"
              data-id="{{this.owner}}">{{getAuthorName
                this.owner}}</span>
    </a>
    {{#unless singleUniversity}}
        <a href="#" class="filterCollege"
           title="Filter {{_ "set-list.college"}}: {{#if this.moduleActive}}{{this.college}}{{else}}{{_
                   "set-list.noCollege"}}{{/if}}">
        <span class="col-xs-6 visible-xs poolLabel panelUnit"
              data-id="{{this.college}}">{{_ "set-list.college"}}:</span>
            <span class="col-xs-6 col-sm-2 poolContent poolText panelUnit poolCollege"
                  data-id="{{this.college}}">{{#if this.moduleActive}}{{this.college}}{{else}}{{_
                    "set-list.noCollege"}}{{/if}}</span>
        </a>
    {{/unless}}
    <a href="#" class="filterCourse"
       title="Filter {{_ "set-list.course"}}: {{#if this.moduleActive}}{{this.course}}{{else}}{{_
               "set-list.noCourse"}}{{/if}}">
        <span class="col-xs-6 visible-xs poolLabel panelUnit" data-id="{{this.course}}">{{_
                "set-list.course"}}:</span>
        <span class="col-xs-6 col-sm-2 poolContent poolText panelUnit poolCourse"
              data-id="{{this.course}}">{{#if this.moduleActive}}{{this.course}}{{else}}{{_
                "set-list.noCourse"}}{{/if}}</span>
    </a>
    <a href="#" class="{{#if this.moduleActive}}filterModule{{else}}filterNoModule{{/if}}"
       title="Filter {{_ "set-list.module"}}: {{#if this.moduleActive}}{{this.module}}{{else}}{{_
               "set-list.noModuleLong"}}{{/if}}">
        <span class="col-xs-6 visible-xs poolLabel panelUnit" data-id="{{this.module}}">{{_
                "set-list.module"}}:</span>
        <span class="col-xs-6 col-md-1 hidden-sm poolContent poolText panelUnit poolModule"
              data-id="{{this.module}}">{{#if this.moduleActive}}{{this.moduleToken}}{{else}}{{_
                "set-list.noModuleShort"}}{{/if}}</span>
    </a>
    <span class="col-sd-2 col-md-1 kind-label hidden-xs panelAvailability">
        <a href="#" class="filterCheckbox" title="Filter {{_ "set-list.availability"}}: {{this.kind}}">
            <span class="kind-label col-sm-1 col-md-6 hidden-xs licenseInfo panelUnit panelUnitNoBorder pool-{{this.kind}}"
                  data-id="{{this.kind}}">
                {{{getKind this.kind}}}
            </span>
            <span class="col-sm-1 col-md-6 hidden-xs licenseInfo panelUnit panelUnitPrice" data-id="{{this.kind}}">
                {{#if displayPrice}}
                    {{{getPrice this.price}}}
                {{/if}}
            </span>
        </a>
    </span>
    <a href="#" class="filterCheckbox" title="Filter {{_ "set-list.availability"}}: {{this.kind}}">
        <span class="col-xs-12 visible-xs poolLabel poolText panelAvailability panelUnitNoBorder"
              data-id="{{this.kind}}">
            <span class="col-xs-6 visible-xs poolLabel panelUnit"
                  data-id="{{this.kind}}">{{_
                    "set-list.availability"}}:</span>
            <span class="kind-label col-xs-3 visible-xs licenseInfo panelUnit panelUnitKind info_license_mobile"
                  data-id="{{this.kind}}">
                {{{getKind this.kind}}}
            </span>
            <span class="col-xs-3 visible-xs licenseInfo panelUnit panelUnitPrice info_license_mobile"
                  data-id="{{this.kind}}">
                {{#if displayPrice}}
                    {{{getPrice this.price}}}
                {{/if}}
            </span>
        </span>
    </a>
    <a href="#" class="filterRating"
       title="{{this.name}} {{_ "set-list.rating"}}: {{this.relevance}} {{_ "rating-field.stars"}}"
       data-id={{getRelevance}}>
        <span class="col-xs-6 visible-xs poolLabel panelUnit panelUnitNoBorder"
              data-id={{getRelevance}}>{{_
                "set-list.rating"}}
            :</span>
        <span class="col-xs-6 col-md-1 hidden-sm poolContent raterCount panelUnit panelUnitNoBorder"
              data-id={{getRelevance}}>
            <img src="./img/stars/stars{{getStarsRating}}.png" class="stars-rating" data-id={{getRelevance}}><span
                class="raterCountNumber pull-right">({{this.raterCount}})</span>
        </span>
    </a>
</template>

<template name="enterActiveLearnphaseModal">
    <div class="modal fade" id="enterActiveLearnphaseModal" tabindex="-1" role="dialog"
         aria-labelledby="enterActiveLearnphaseTitle">
        <div class="modal-dialog">
            <div class="modal-content modal-content-for-buttons col-xs-12">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 id="enterActiveLearnphaseTitle" class="modal-title">{{_ "confirm-enter-learnphase.title"}}</h4>
                </div>
                <div class="modal-body">
                    <p>{{_ "confirm-enter-learnphase.text"}}</p>
                    <ul>
                        <li>{{_ "panel-body.givenname"}}</li>
                        <li>{{_ "panel-body.birthname"}}</li>
                        <li>{{_ "panel-body.email"}}</li>
                    </ul>
                    <p>{{_ "confirm-enter-learnphase.text2"}}</p>
                </div>
                <hr>
                <button id="enterActiveLearnphaseConfirm"
                        class="btn btn-success btn-raised btn-block active">{{_
                        "confirm-enter-learnphase.enter"}}</button>
                <button id="enterActiveLearnphaseCancel" class="btn btn-default btn-block btn-raised col-xs-12"
                        data-dismiss="modal">{{_ "confirm-enter-learnphase.close"}}</button>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
</template>

<template name="poolTitleContent">
    <span class="col-xs-6 visible-xs poolLabel panelUnit" data-id="{{content._id}}">{{_
            "set-list.topicMobile"}}
        :</span>
    <span id="cardsetLink{{content.index}}" class="cell col-xs-6 cardsetName {{#unless
            singleUniversity}}col-sm-3{{else}}col-sm-4{{/unless}} poolText panelUnit" data-id="{{content._id}}">
                <span class="cell col-xs-8 {{#unless
                        singleUniversity}}col-sm-9{{else}}col-sm-10{{/unless}} topicName" data-id="{{content._id}}">
                    {{#if content.learningActive}}
                        <span class="label label-success" aria-label="active learnphase label"
                              data-id="{{content._id}}">{{_
                                "set-list.activeLearnphase"}}</span>
                    {{/if}}
                    {{content.name}}
                </span>
                <span class="cell badge cardsetBadge" data-id="{{content._id}}">
                    {{countCards content._id}}
                </span>
            </span>
</template>

<template name="poolCardsetEmpty">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 empty-list panel panel-default cardsetInfo ">
        <br>
        <span class="emptyTextList">{{_ "set-list-empty.emptypooltextlist"}}</span>
        <br>
        <br>
    </div>
</template>
