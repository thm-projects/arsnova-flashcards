<template name="cardset">
  {{#if hasPermission}}
    {{> cardsetForm}}
    {{onEditmodalClose this._id}}
    {{> sidebarCardset}}
    {{> cardButtons}}
    {{#if isActiveRoute 'cardsetdetailsid'}}
      {{> cardsetDetails}}
    {{/if}}
    {{#if isActiveRoute 'cardsetlistid'}}
      {{> cardsetList}}
    {{/if}}
  {{else}}
    <h4>{{_ "permission"}}</h4>
  {{/if}}
</template>


<template name="sidebarCardset">
  <div class="col-md-3">
    <div id="set-details-sideBar-region">
      <div class="well well-sm sidebar-nav">
        {{#if isOwner}}
          <a id="editCardset" class="btn-editCardset btn btn-default btn-xs" data-toggle="modal" data-target="#editSetModal">
            <i class="glyphicon glyphicon-pencil"></i>
          </a>
        {{/if}}
        <h4 style="margin:0">{{name}}</h4>

        <hr />

        <span style="font-family:'Georgia'; font-style:italic">{{description}}</span>

        <hr />

        <span class="nav-header" style="padding-left:0">{{_ "sidebar-nav.created"}}</span>
        <span style="font-family:'Georgia'">
          <a id="usr-profile2" role="button">{{username}}</a>
          <br>
          <span>{{_ "sidebar-nav.at"}}</span>
          <span>{{getDate}}</span>
        </span>

        <hr />

        {{#if ratingEnabled}}
          <span class="nav-header-cardset">{{_ "valuation"}}</span>
          <div class="panel panel-default">
            <div class="ratingStars">
              {{#if hasRated}}
                {{> starsRating id='ratingLocked' rating=getAverage mutable=false}}
              {{else}}
                {{> starsRating id='rating' rating=0 mutable=true}}
              {{/if}}
            </div>
            <span class="ratingText text-muted">
              <span>&#216; {{getAverage}} {{_ "valuation2"}}</span>
              <span>{{_ "valuationtext"}} {{countRatings}} {{_ "valuationtext2"}}</span>
            </span>
          </div>
        {{/if}}

        <hr />

        <span class="nav-header-cardset">{{_ "sidebar-nav.view"}}</span>
        <div class="btn-group btn-group-xs btn-group-justified">
          <a id="btnToCardLayout" class="btn btn-default btn-cardLayout {{#if isActiveRoute 'cardsetdetailsid'}}active{{/if}}" href="/cardset/{{_id}}">{{_ "sidebar-nav.viewmap"}}</a>
          <a id="btnToListLayout" class="btn btn-default btn-listLayout {{#if isActiveRoute 'cardsetlistid'}}active{{/if}}" href="/cardsetlist/{{_id}}">{{_ "sidebar-nav.viewlist"}}</a>
        </div>
      </div>
    </div>

    <div id="set-details-learn-region">
      <div class="well well-sm sidebar-nav">
        <span class="nav-header-cardset">{{_ "learn"}}</span>
        <button id="learnBox" class="btn btn-default learn btn-block">{{_ "learnfile"}}</button>
        <button id="learnMemo" class="btn btn-default memo btn-block">{{_ "memo"}}</button>
      </div>
    </div>
  </div>
</template>

<template name="cardButtons">
  {{#if isOwner}}
    <div class="col-md-9">
      <div class="btn-group btn-group-justified button-group-content" role="group">
        <div class="btn-group" role="group">
          <button class="btn btn-primary btn-default newCard" id="set-details-controls-btn-newCard">{{_ "sidebar-nav.createcard"}}</button>
        </div>
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-default importCards" id="set-details-controls-btn-importCards" data-toggle="modal" data-target="#importModal">{{_ "sidebar-nav.importcard"}}</button>
        </div>
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-default exportCards" id="set-details-controls-btn-exportCards">{{_ "sidebar-nav.exportcard"}}</button>
        </div>
      </div>
    </div>
    {{> cardsetImportForm}}
  {{/if}}
</template>

<template name="cardsetDetails">
  <div class="col-md-9" id="set-details-region">
    <div>
      {{#if countCards this._id}}
        <div id="cardCarousel" class="carousel slide" data-interval="false">
          <div class="carousel-inner">
            {{#each getCards}}
              <div class="item {{#if cardActive @index}}active{{/if}}">
                <div class="box">
                  {{#if isOwner}}
                    <a id="editCard" class="btn-editCard btn btn-default btn-xs" href="{{pathFor route='editCard'}}" style="display: inline;">
                      <i class="glyphicon glyphicon-pencil"></i>
                    </a>
                  {{/if}}
                  <span id="clicktoflip" class="clicktoflip">Click to flip</span>
                  <img class="cardside cardfront-symbol" src="/img/icon_front.png">
                  <img class="cardside cardback-symbol" src="/img/icon_back.png" style="display: none;">
                  <div class="block">
                    {{cardDetailsMarkdown this.front this.back @index}}
                    <div class="cardContent centered cardfront detailfront{{@index}}">
                      <p>{{front}}</p>
                    </div>
                    <div class="cardContent centered cardback detailback{{@index}}" style="display:none">
                      <p>{{back}}</p>
                    </div>
                  </div>
                  <div class="cardNumber">
                    {{cardsIndex @index}}/{{countCards this.cardset_id}}
                  </div>
                </div>
              </div>
            {{/each}}
          </div>

          {{#if cardCountOne this._id}}
            <a id="leftCarouselControl" class="left carousel-control" href="#cardCarousel" data-slide="prev">
              <span class="icon-prev"></span>
            </a>
            <a id="rightCarouselControl" class="right carousel-control" href="#cardCarousel" data-slide="next">
              <span class="icon-next"></span>
            </a>
          {{/if}}
        </div>

      {{else}}
        <div id="cardCarousel" class="carousel slide" data-interval="false">
          <div class="carousel-inner">
            <div class="empty-item">
              <div class="box">
                <div class="block">
                  <div class="centered front" style="font-size:2em">{{_ "nocards"}}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      {{/if}} {{> cardsetPictureForm}}
    </div>
  </div>
</template>


<template name="cardsetList">
  <div class="col-md-9" id="set-details-region">
    <table class="table table-bordered table-striped table-hover">
      <div class="listhead"></div>
      <thead>
        <tr>
          <th>
            <span>{{_ "frontside"}}</span>
            <a class="frontdown" role="button">⇓</a>
            <a class="frontup" role="button">⇑</a>
          </th>
          <th>
            <span>{{_ "backside"}}</span>
            <a class="backdown" role="button">⇓</a>
            <a class="backup" role="button">⇑</a>
          </th>
          <th>{{_ "options"}}</th>
        </tr>
      </thead>
      <tbody>
        {{#if countCards this._id}}
          {{#each cardList}}
            <tr class="listitem">
              {{cardlistMarkdown this.front this.back @index}}
              <td class="front{{@index}}"></td>
              <td class="back{{@index}}"></td>
              <td>
                {{#if isOwner}}
                  <a class="editCardList btn btn-xs btn-default btn-listEditCard" title='{{_ "editcard"}}' href="{{pathFor route='editCard'}}" style="margin-left: 5px;">
                    <i class="glyphicon glyphicon-pencil"></i>
                  </a>
                  <a class="deleteCardList btn btn-xs btn-default btn-listDeleteCard" title='{{_ "deletecard"}}' href="">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                  </a>
                {{/if}}
              </td>
            </tr>
          {{/each}} {{else}}
          <tr class="empty-listitem">
            <td colspan="3" align="center">
              <span style="font-family:'Georgia'">{{_ "nocards"}}</span>
            </td>
          </tr>
        {{/if}}

      </tbody>
      {{> cardsetPictureForm}}
    </table>
  </div>
</template>


<template name="cardsetForm">
  <div class="modal fade" id="editSetModal" tabindex="-1" role="dialog" aria-labelledby="editSetModalTitle">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 id="editSetModalTitle" class="modal-title">{{_ "modal-dialog.editcard"}}</h4>
        </div>
        <div class="modal-body">
          <div class="form-horizontal">
            <div class="form-group setdetails name">
              <label id="editSetNameLabel" class="col-md-3 control-label" for="editSetName">{{_ "modal-dialog.name"}}</label>
              <div class="col-md-9">
                <input class="form-control" type="text" id="editSetName" value="{{name}}">
                <span id="helpEditSetName" class="help-block name"></span>
              </div>
            </div>
            <div class="form-group setdetails description">
              <label id="editSetDescriptionLabel" class="col-md-3 control-label" for="editSetDescription">{{_ "modal-dialog.description"}}</label>
              <div class="col-md-9">
                <textarea class="form-control" rows="3" id="editSetDescription" value="{{description}}"></textarea>
                <span id="helpEditSetDescription" class="help-block description"></span>
              </div>
            </div>
            <div class="form-group setdetails categories">
              <label id="editSetCategoryLabel" class="col-md-3 control-label" for="newSetCategory">{{_ "modal-dialog.category"}}</label>
              <div class="col-md-9">
                <div class="dropdown">
                  <button class="btn btn-default dropdown-toggle" type="button" id="editSetCategoryDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    <span id="editSetCategory">{{getCategory this.category}}</span>
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    {{#each getCategories}}
                      <li class="category" value="{{_id}}" data="{{name}}"><a href="#">{{name}}</a></li>
                    {{/each}}
                  </ul>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label" for="editSetDescription">{{_ "modal-dialog.visibility"}}</label>
              <div class="controls col-md-9">
                <div id="editCardSetVisibility" class="btn-group" data-toggle="buttons">
                  <label id="visibilityoption1" class="btn private btn-default {{#if visible false}}active{{/if}}" style="width:100px">
                    <input type="radio" name="options" value="false" id="edit_visibility_private">
                    <span>{{_ "modal-dialog.visibilityoption1"}}</span>
                  </label>
                  <label id="visibilityoption2" class="btn public btn-default {{#if visible true}}active{{/if}}" style="width:100px">
                    <input type="radio" name="options" value="true" id="edit_visibility_public">
                    <span>{{_ "modal-dialog.visibilityoption2"}}</span>
                  </label>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3 control-label" for="newSetDescription">{{_ "modal-dialog.rating"}}</label>
              <div class="controls col-md-9">
                <div id="editCardSetRating" class="btn-group btn-group-rating" data-toggle="buttons">
                  <label id="ratingoption1" class="btn rating-true btn-default {{#if ratings true}}active{{/if}}" style="width:100px">
                    <input type="radio" name="rating" value="true" id="rating_true">
                    <span>{{_ "modal-dialog.ratingoption1"}}</span>
                  </label>
                  <label id="ratingoption2" class="btn rating-false btn-default {{#if ratings false}}active{{/if}}" style="width:100px">
                    <input type="radio" name="rating" value="false" id="rating_false">
                    <span>{{_ "modal-dialog.ratingoption2"}}</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cardSetCancel" class="btn btn-default" data-dismiss="modal">{{_ "modal-dialog.cancel"}}</button>
          <button id="cardSetDelete" class="btn btn-danger pull-left btn-setDelete" style="width:150px">{{_ "modal-dialog.delete"}}</button>
          <button id="cardSetConfirm" class="btn btn-warning pull-left" style="width:150px; display:none">{{_ "modal-dialog.confirm"}}</button>
          <button id="cardSetSave" class="btn btn-primary">{{_ "modal-dialog.save"}}</button>
        </div>
      </div>
    </div>
  </div>
</template>


<template name="cardsetPictureForm">
  <div class="modal fade" id="pictureModal" tabindex="-1" role="dialog" aria-labelledby="pictureModalTitle">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 id="pictureModalTitle" class="modal-title"></h4>
        </div>
        <div class="modal-body" id="setdetails-pictureModal-body"></div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
  <!-- /.modal -->
</template>

<template name="cardsetImportForm">
  <div class="modal fade" id="importModal" tabindex="-1" role="dialog" aria-labelledby="importModalTitle">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 id="importModalTitle" class="modal-title">Upload a CSV</h4>
        </div>
        <div class="modal-body">
          {{#unless uploading}}
            <input type="file" name="uploadFile">
          {{else}}
            <p><i class="fa fa-spin fa-refresh"></i> Uploading files...</p>
          {{/unless}}
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
  <!-- /.modal -->
</template>
